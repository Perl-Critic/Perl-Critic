name: "Docker image"

on:
  push:
    tags:
      - "v[0-9]+\\.[0-9]+"

jobs:
  docker-image:
    runs-on: "ubuntu-latest"
    if: "github.repository_owner == 'Perl-Critic'"
    steps:
      - uses: "docker/setup-qemu-action@v2"
      - uses: "docker/setup-buildx-action@v2"
      - uses: "docker/login-action@v2"
        with:
          registry: "ghcr.io"
          username: "${{ github.repository_owner }}"
          password: "${{ secrets.GITHUB_TOKEN }}"
      - uses: "docker/build-push-action@v3"
        with:
          platforms: "linux/amd64,linux/arm64"
          tags: "ghcr.io/perl-critic/perl-critic:${{ github.ref_name }}"
          push: true
